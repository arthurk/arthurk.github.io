<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="author" content="Arthur Koziel">
  <title>DockerHub Docker Registry API Examples</title>
  <link rel="alternate" type="application/rss+xml" title="RSS" href="https://www.arthurkoziel.com/feed.xml">
  <style>
  /* light theme for mobile screens,
     dark theme and laptop/desktop overrides at bottom */
  body {
    font-family: Helvetica, Arial, "Liberation Sans", sans-serif;
    font-weight: 400;
    font-size: 1rem;
    line-height: 1.25;
    max-width: 630px;
    margin: 0 15px;
    background-color: #fff;
    color: #0b0c0c;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    text-transform: none;
    overflow-wrap: break-word;
    word-wrap: break-word;
    margin-bottom: 50px;
  }

  /* links */
  a { color: #1d70b8 }
  a:hover { color: #003078 }

  /* main heading and date */
  nav {
    margin-bottom: 30px;
  }

  /* headings */
  h1, h2, h3 {
    color: #202124;
    font-weight: 700;
    margin-top: 0;
  }

  h1 {
    font-size: 2rem;
    line-height: 1.09;
    margin-bottom: 30px;
  }

  h2 {
    font-size: 1.5rem;
    line-height: 1.05;
    margin-bottom: 20px;
  }

  h3 {
    font-size: 1.125rem;
    line-height: 1.11;
    margin-bottom: 15px;
  }

  /* date below main heading */
  #date {
    color: #505a5f;
    font-weight: 400;
    margin-top: 0;
    margin-bottom: 15px;
  }

  /* images */
  img {
    height: auto;
    max-width: 100%;
    vertical-align: middle;
  }

  /* code */
  code, pre {
    font-size: 0.9rem;
  }

  pre {
    padding: 1rem;
    overflow: auto;
    margin: 25px 0;
  }

  /* inline code */
  article > p > code, article > ul > li > code {
    font-weight: 700;
    color: #202124;
  }

  /* tables */
  table {
    border-collapse: collapse;
    margin: 18px 0;
  }

  table tr {
    vertical-align: top;
  }

  table td {
    border-bottom: 1px solid #777;
    padding: .5em 0;
  }

  table tr:last-child td {
    border-bottom: 0;
  }

  /* first column */
  table td:nth-child(1) {
    width: 25%;
    padding-right: 1em;
    color: #777;
  }

  /* lists */
  ul, ol {
    font-size: 1rem;
    line-height: 1.25;
    margin-bottom: 15px;
    padding-left: 20px;
  }

  ul > li, ol > li {
    margin-bottom: 1em;
  }

  ul#blog-archive {
    font-size: 1rem;
    margin: 0;
    padding: 0;
  }

  ul#blog-archive li {
    list-style: none;
    margin-top: 20px;
    margin-bottom: 0;
    padding-top: 10px;
    border-top: 1px solid #b1b4b6;
  }

  ul#blog-archive li a {
    font-weight: 700;
  }

  ul#blog-archive li p {
    margin: 5px 0;
    color: #505a5f;
  }

  /*
  * Laptop/Desktop screens
  */

  @media(min-width: 48em) {
    body {
        font-size: 1.1875rem;
        line-height: 1.31;
        margin-right:auto;
        margin-left: auto;
    }

    h1 {
      font-size: 3rem;
      line-height: 1.04;
    }

    h2 {
      font-size: 2.25rem;
      line-height: 1.11;
      margin-bottom: 30px;
    }

    h3 {
      font-size: 1.5rem;
      line-height: 1.25;
      margin-bottom: 20px;
    }

    ol, ul {
      font-size: 1.1875rem;
      line-height: 1.31;
      margin-bottom: 20px;
    }

    ul#blog-archive {
      font-size: 1.1875rem;
      line-height: 1.31;
    }

    ul#blog-archive li p {
      font-size: 1rem;
      line-height: 1.5
    }

    code, pre {
      font-size: 1rem;
    }
  }

  /*
  * Dark theme
  */

  @media (prefers-color-scheme: dark) {
    body {
      background-color: #202124;
      color: #bdc1c6;
    }
    h1, h2, h3 { color: #e8eaed }
    #date, ul#blog-archive li p {
      color: #bdc1c6
    }
    article > p > code, article > ul > li > code {
      color: #bdc1c6
    }
    a { color: #8ab4f8  }
    a:hover { color: #fff }
    li::marker { color: #e8eaed }
  }
</style>
</head>
<body>
<nav>
  <p>
    <a href="https://www.arthurkoziel.com/">Home</a> |
    <a href="https://www.arthurkoziel.com/blog/">Blog</a>
  </p>
</nav>


<article>
  <header>
    <h1 class="title">DockerHub Docker Registry API Examples</h1>
    <div id="date">
      <time class="date" datetime="2020-05-10">May 10, 2020</time>
    
    </div>
  </header>

  <p>This post contains examples of REST API calls to <a href="https://hub.docker.com">DockerHub</a> and the DockerHub <a href="https://docs.docker.com/registry/spec/api/">Docker Registry</a>. We're going to list all images for a user, list all tags for an image and get the manifest for an image.</p>
<h2 id="list-public-images">List public images</h2>
<p>We're going to use the DockerHub API to get the list of images for a user. This is because the DockerHub Docker Registry does not implement the <a href="https://docs.docker.com/registry/spec/api/#listing-repositories">/v2/_catalog</a> endpoint to list all repositories in the registry.</p>
<pre style="background-color:#282a36;color:#f8f8f2;"><code><span>$ curl -s &quot;https://hub.docker.com/v2/repositories/ansible/?page_size=100&quot; | jq -r &#39;.results|.[]|.name&#39;
</span><span>
</span><span>awx_task
</span><span>awx_web
</span><span>awx_rabbitmq
</span><span>ansible
</span><span>centos7-ansible
</span><span>ubuntu14.04-ansible
</span><span>...
</span></code></pre>
<p>The DockerHub API is undocumented but there are projects out there like <a href="https://github.com/RyanTheAllmighty/Docker-Hub-API">this one</a> who did a great job listing available endpoints.</p>
<h2 id="list-private-images">List private images</h2>
<p>To include private images we need to get an authentication token (JWT) which we can then include in subsequent requests:</p>
<pre style="background-color:#282a36;color:#f8f8f2;"><code><span>$ export DOCKER_USERNAME=&quot;myusername&quot;
</span><span>$ export DOCKER_PASSWORD=&quot;mypassword&quot;
</span><span>
</span><span>$ export TOKEN=$(curl -s -H &quot;Content-Type: application/json&quot; -X POST -d &#39;{&quot;username&quot;: &quot;&#39;${DOCKER_USERNAME}&#39;&quot;, &quot;password&quot;: &quot;&#39;${DOCKER_PASSWORD}&#39;&quot;}&#39; https://hub.docker.com/v2/users/login/ | jq -r .token)
</span><span>
</span><span>$ curl -s -H &quot;Authorization: JWT ${TOKEN}&quot; &quot;https://hub.docker.com/v2/repositories/arthurk/?page_size=100&quot; | jq -r &#39;.results|.[]|.name&#39;
</span><span>
</span><span>my-private-repo
</span></code></pre>
<h2 id="list-tags">List tags</h2>
<p>We need to get an authentication token for the Docker Registry. Note that the JWT from the previous step does not work here. DockerHub and the DockerHub Docker Registry are different services and require different authentication credentials.</p>
<pre style="background-color:#282a36;color:#f8f8f2;"><code><span>$ export AUTH_SERVICE=&#39;registry.docker.io&#39;
</span><span>$ export AUTH_SCOPE=&quot;repository:ansible/ansible:pull&quot;
</span><span>
</span><span>$ export TOKEN=$(curl -fsSL &quot;https://auth.docker.io/token?service=$AUTH_SERVICE&amp;scope=$AUTH_SCOPE&quot; | jq --raw-output &#39;.token&#39;)
</span><span>
</span><span>$ curl -fsSL \
</span><span>    -H &quot;Authorization: Bearer $TOKEN&quot; \
</span><span>    &quot;$REGISTRY_URL/v2/ansible/ansible/tags/list&quot; | jq
</span><span>{
</span><span>  &quot;name&quot;: &quot;ansible/ansible&quot;,
</span><span>  &quot;tags&quot;: [
</span><span>    &quot;centos6&quot;,
</span><span>    &quot;centos7&quot;,
</span><span>    &quot;cloudstack-simulator&quot;,
</span><span>    ...
</span><span>  ]
</span><span>}
</span></code></pre>
<h2 id="get-image-manifest">Get image manifest</h2>
<p>We re-use the token from the previous step to make a request that gets the manifest for the <code>ansible:centos7</code> image:</p>
<pre style="background-color:#282a36;color:#f8f8f2;"><code><span>$ curl -fsSL \
</span><span>    -H &quot;Authorization: Bearer $TOKEN&quot; \
</span><span>    &quot;$REGISTRY_URL/v2/ansible/ansible/manifests/centos7&quot; | jq
</span><span>
</span><span>{
</span><span>  &quot;schemaVersion&quot;: 1,
</span><span>  &quot;name&quot;: &quot;ansible/ansible&quot;,
</span><span>  &quot;tag&quot;: &quot;centos7&quot;,
</span><span>  &quot;architecture&quot;: &quot;amd64&quot;,
</span><span>  &quot;fsLayers&quot;: [
</span><span>    {
</span><span>      &quot;blobSum&quot;: &quot;sha256:a3ed95caeb02ffe68cdd9fd84406680ae93d633cb16422d00e8a7c22955b46d4&quot;
</span><span>    },
</span><span>    ...
</span><span>  ],
</span><span>  &quot;history&quot;: [...],
</span><span>  &quot;signatures&quot;: [...]
</span><span>}
</span></code></pre>
<h2 id="skopeo">Skopeo</h2>
<p><a href="https://github.com/containers/skopeo">Skopeo</a> is a CLI tool that makes it easy to quickly check information about docker images such as the available tags:</p>
<pre style="background-color:#282a36;color:#f8f8f2;"><code><span>$ skopeo inspect docker://ansible/galaxy
</span><span>{
</span><span>    &quot;Name&quot;: &quot;docker.io/ansible/galaxy&quot;,
</span><span>    &quot;Digest&quot;: &quot;sha256:24d0b67d936ca6e7bca253169fc268748d7585c0cee723c14e8e51f37cfd3591&quot;,
</span><span>    &quot;RepoTags&quot;: [
</span><span>        &quot;2.3.0&quot;,
</span><span>        &quot;2.3.1&quot;,
</span><span>        &quot;2.4.0&quot;,
</span><span>        &quot;3.0.0&quot;,
</span><span>        &quot;3.0.1&quot;,
</span><span>        ...
</span><span>        &quot;3.1.6&quot;,
</span><span>        &quot;3.1.7&quot;,
</span><span>        &quot;3.1.8&quot;,
</span><span>        &quot;develop&quot;,
</span><span>        &quot;latest&quot;
</span><span>    ],
</span><span>    &quot;Created&quot;: &quot;2019-03-15T09:24:18.817740071Z&quot;,
</span><span>    &quot;DockerVersion&quot;: &quot;17.09.0-ce&quot;,
</span><span>    &quot;Labels&quot;: {
</span><span>        &quot;org.label-schema.build-date&quot;: &quot;20190305&quot;,
</span><span>        &quot;org.label-schema.license&quot;: &quot;GPLv2&quot;,
</span><span>        &quot;org.label-schema.name&quot;: &quot;CentOS Base Image&quot;,
</span><span>        &quot;org.label-schema.schema-version&quot;: &quot;1.0&quot;,
</span><span>        &quot;org.label-schema.vendor&quot;: &quot;CentOS&quot;
</span><span>    },
</span><span>    &quot;Architecture&quot;: &quot;amd64&quot;,
</span><span>    &quot;Os&quot;: &quot;linux&quot;,
</span><span>    &quot;Layers&quot;: [
</span><span>        &quot;sha256:8ba884070f611d31cb2c42eddb691319dc9facf5e0ec67672fcfa135181ab3df&quot;,
</span><span>        ...
</span><span>    ],
</span><span>    &quot;Env&quot;: [
</span><span>        &quot;PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin&quot;,
</span><span>        &quot;PIP_NO_CACHE_DIR=off&quot;,
</span><span>        &quot;VENV_BIN=/var/lib/galaxy/venv/bin&quot;,
</span><span>        &quot;TINI_VERSION=v0.16.1&quot;,
</span><span>        &quot;HOME=/var/lib/galaxy&quot;,
</span><span>        &quot;DJANGO_SETTINGS_MODULE=galaxy.settings.production&quot;,
</span><span>        &quot;GIT_COMMITTER_NAME=Ansible Galaxy&quot;,
</span><span>        &quot;GIT_COMMITTER_EMAIL=galaxy@ansible.com&quot;
</span><span>    ]
</span><span>}
</span></code></pre>

</article>


</body>
</html>
